# Azure Developer CLI configuration for Finelle UI
name: finelle-ui
metadata:
  template: finelle-react-containerapp@0.0.1-beta

# Infrastructure configuration
infra:
  provider: bicep
  path: infra
  module: main
  outputs:
    containerRegistryLoginServer: containerRegistryLoginServer
    containerRegistryName: containerRegistryName
    containerAppFQDN: containerAppFQDN
    AZURE_CONTAINER_REGISTRY_ENDPOINT: containerRegistryLoginServer

# Services configuration
services:
  ui:
    project: .
    dist: dist
    language: js
    host: containerapp
    docker:
      path: ./Dockerfile
      context: .
      registry: ${AZURE_CONTAINER_REGISTRY_ENDPOINT}

# Hooks for deployment lifecycle
hooks:
  predeploy:
    windows:
      shell: pwsh
      run: |
        echo "Starting pre-deployment checks..."
        echo "Building React application..."
        npm run build
    posix:
      shell: sh
      run: |
        echo "Starting pre-deployment checks..."
        echo "Building React application..."
        npm run build
  postdeploy:
    windows:
      shell: pwsh
      run: |
        echo "Deployment completed successfully!"
        echo "Application URL: $Env:AZURE_CONTAINER_APP_URL"
        echo "Container Registry: $Env:AZURE_CONTAINER_REGISTRY_ENDPOINT"
        echo "Note: Initial deployment uses placeholder image for speed"
        echo "Custom image will be updated during azd deploy phase"
    posix:
      shell: sh
      run: |
        echo "Deployment completed successfully!"
        echo "Application URL: $AZURE_CONTAINER_APP_URL"
        echo "Container Registry: $AZURE_CONTAINER_REGISTRY_ENDPOINT"
        echo "Note: Initial deployment uses placeholder image for speed"
        echo "Custom image will be updated during azd deploy phase"
